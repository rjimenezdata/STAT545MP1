<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.25">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Dillon and Ruben">

<title>MP1</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="MP1_files/libs/clipboard/clipboard.min.js"></script>
<script src="MP1_files/libs/quarto-html/quarto.js" type="module"></script>
<script src="MP1_files/libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="MP1_files/libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="MP1_files/libs/quarto-html/popper.min.js"></script>
<script src="MP1_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="MP1_files/libs/quarto-html/anchor.min.js"></script>
<link href="MP1_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="MP1_files/libs/quarto-html/quarto-syntax-highlighting-7b89279ff1a6dce999919e0e67d4d9ec.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="MP1_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="MP1_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="MP1_files/libs/bootstrap/bootstrap-d6a003b94517c951b2d65075d42fb01b.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script src="MP1_files/libs/kePrint-0.0.1/kePrint.js"></script>
<link href="MP1_files/libs/lightable-0.0.1/lightable.css" rel="stylesheet">


</head>

<body class="fullcontent quarto-light">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">MP1</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Dillon and Ruben </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="preprocessing" class="level1">
<h1>Preprocessing</h1>
<section id="data-preprocessing" class="level2">
<h2 class="anchored" data-anchor-id="data-preprocessing">Data Preprocessing</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># imperial beach station USW00093115</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 12/25/2008 - 1/12/2026</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>sd <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"https://www.ncei.noaa.gov/access/past-weather/USW00093115/data.csv"</span>, <span class="at">skip =</span> <span class="dv">1</span>) <span class="sc">|&gt;</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Date =</span> <span class="fu">as.Date</span>(Date, <span class="at">tryFormats =</span> <span class="st">"%Y-%m-%d"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Date <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2026-01-05"</span>),</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>         Date <span class="sc">&gt;=</span> <span class="fu">as.Date</span>(<span class="st">"2014-08-01"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">prcp =</span> <span class="st">"PRCP..Inches."</span>,</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">temp_max =</span> <span class="st">"TMAX..Degrees.Fahrenheit."</span>) <span class="sc">|&gt;</span> </span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Date, prcp, temp_max)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="co"># marin county station USC00047880</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="co"># 10/31/2008 - 1/21/2026</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>marin <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"https://www.ncei.noaa.gov/access/past-weather/USC00047880/data.csv"</span>, <span class="at">skip =</span> <span class="dv">1</span>) <span class="sc">|&gt;</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Date =</span> <span class="fu">as.Date</span>(Date, <span class="at">tryFormats =</span> <span class="st">"%Y-%m-%d"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Date <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2026-01-05"</span>),</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>         Date <span class="sc">&gt;=</span> <span class="fu">as.Date</span>(<span class="st">"2014-08-01"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">prcp =</span> <span class="st">"PRCP..Inches."</span>,</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>         <span class="at">temp_max =</span> <span class="st">"TMAX..Degrees.Fahrenheit."</span>) <span class="sc">|&gt;</span> </span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Date, prcp, temp_max)</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="co"># slo county station USW00093206 </span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a><span class="co"># 10/31/2008 - 1/21/2026</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>slo <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">'https://www.ncei.noaa.gov/access/past-weather/USW00093206/data.csv'</span>, <span class="at">skip =</span> <span class="dv">1</span>) <span class="sc">|&gt;</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Date =</span> <span class="fu">as.Date</span>(Date, <span class="at">tryFormats =</span> <span class="st">"%Y-%m-%d"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Date <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2026-01-05"</span>),</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>         Date <span class="sc">&gt;=</span> <span class="fu">as.Date</span>(<span class="st">"2014-08-01"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">prcp =</span> <span class="st">"PRCP (Inches)"</span>,</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>         <span class="at">temp_max =</span> <span class="st">"TMAX (Degrees Fahrenheit)"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Date, prcp, temp_max)</span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>weather_all <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(</span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>  sd    <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">location =</span> <span class="st">"San Diego"</span>),</span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>  slo   <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">location =</span> <span class="st">"SLO County"</span>),</span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>  marin <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">location =</span> <span class="st">"Marin County"</span>)</span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
</section>
<section id="add-rain-temp-season-states" class="level2">
<h2 class="anchored" data-anchor-id="add-rain-temp-season-states">Add Rain + Temp + Season States</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Rain</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 0 inches = none</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 0 to 0.75 = light</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># &gt;= 0.75 = heavy</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Temp</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="co"># &lt;63 = cold</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="co"># 63-75 = comfortable</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="co"># &gt;75 = hot</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Seasons:</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Oct-Mar</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Apr-Sept</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>add_weathers <span class="ot">&lt;-</span> <span class="cf">function</span>(df) {</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>  df <span class="sc">%&gt;%</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>      <span class="at">rain =</span> <span class="fu">case_when</span>(</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>        prcp <span class="sc">==</span> <span class="dv">0</span>              <span class="sc">~</span> <span class="st">"none"</span>,</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>        prcp <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> prcp <span class="sc">&lt;</span> <span class="fl">0.5</span>    <span class="sc">~</span> <span class="st">"light"</span>,</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>        prcp <span class="sc">&gt;=</span> <span class="fl">0.5</span>              <span class="sc">~</span> <span class="st">"heavy"</span>,</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>        <span class="cn">TRUE</span>                   <span class="sc">~</span> <span class="cn">NA_character_</span></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>      <span class="at">temp =</span> <span class="fu">case_when</span>(</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>        temp_max <span class="sc">&lt;</span> <span class="dv">63</span>                   <span class="sc">~</span> <span class="st">"cold"</span>,</span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>        temp_max <span class="sc">&gt;=</span> <span class="dv">63</span> <span class="sc">&amp;</span> temp_max <span class="sc">&lt;=</span> <span class="dv">75</span> <span class="sc">~</span> <span class="st">"comfortable"</span>,</span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>        temp_max <span class="sc">&gt;</span> <span class="dv">75</span>                   <span class="sc">~</span> <span class="st">"hot"</span>,</span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>        <span class="cn">TRUE</span>                            <span class="sc">~</span> <span class="cn">NA_character_</span></span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>      <span class="at">season =</span> <span class="fu">case_when</span>(</span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>        lubridate<span class="sc">::</span><span class="fu">month</span>(Date) <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">10</span>,<span class="dv">11</span>,<span class="dv">12</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>) <span class="sc">~</span> <span class="st">"Oct–Mar"</span>,</span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>        lubridate<span class="sc">::</span><span class="fu">month</span>(Date) <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>)    <span class="sc">~</span> <span class="st">"Apr–Sep"</span>,</span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>        <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA_character_</span></span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>      <span class="at">rain =</span> <span class="fu">factor</span>(rain, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"none"</span>, <span class="st">"light"</span>, <span class="st">"heavy"</span>)),</span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>      <span class="at">temp =</span> <span class="fu">factor</span>(temp, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"cold"</span>, <span class="st">"comfortable"</span>, <span class="st">"hot"</span>)),</span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a>      <span class="at">season   =</span> <span class="fu">factor</span>(season, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Oct–Mar"</span>, <span class="st">"Apr–Sep"</span>))</span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a>weather_all <span class="ot">&lt;-</span> weather_all <span class="sc">|&gt;</span> <span class="fu">add_weathers</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
</section>
<section id="helper-functions" class="level2">
<h2 class="anchored" data-anchor-id="helper-functions">Helper Functions</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>state_props <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  tab <span class="ot">&lt;-</span> <span class="fu">table</span>(x, <span class="at">useNA =</span> <span class="st">"always"</span>)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">state =</span> <span class="fu">names</span>(tab),</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">n     =</span> <span class="fu">as.integer</span>(tab),</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">prop  =</span> <span class="fu">as.numeric</span>(tab <span class="sc">/</span> <span class="fu">sum</span>(tab))</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>get_table <span class="ot">&lt;-</span> <span class="cf">function</span>(cat_col, ...) {</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>  weather_all <span class="sc">%&gt;%</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(...) <span class="sc">%&gt;%</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">data =</span> <span class="fu">list</span>(<span class="fu">state_props</span>({{ cat_col }})), <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">unnest</span>(data)</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>props_kable <span class="ot">&lt;-</span> <span class="cf">function</span>(df, group_cols, caption_add) {</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>  by_str <span class="ot">&lt;-</span> <span class="fu">paste</span>(group_cols, <span class="at">collapse =</span> <span class="st">" and "</span>)</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>  df <span class="sc">%&gt;%</span></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="fu">all_of</span>(group_cols), state, prop) <span class="sc">%&gt;%</span></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>      <span class="at">prop =</span> scales<span class="sc">::</span><span class="fu">percent</span>(prop, <span class="at">accuracy =</span> <span class="fl">0.01</span>)</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_wider</span>(</span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>      <span class="at">names_from  =</span> state,</span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>      <span class="at">values_from =</span> prop</span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(<span class="fu">across</span>(<span class="fu">all_of</span>(group_cols))) <span class="sc">%&gt;%</span></span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">kable</span>(</span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>      <span class="at">caption =</span> <span class="fu">paste0</span>(caption_add, <span class="st">" State Proportions by "</span>, by_str)</span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">kable_styling</span>(<span class="at">full_width =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">column_spec</span>(<span class="dv">1</span>, <span class="at">bold =</span> <span class="cn">TRUE</span>)</span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a>fit_markov_on_nonmissing_blocks <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(x)</span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a>  is_miss  <span class="ot">&lt;-</span> <span class="fu">is.na</span>(x)</span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a>  block_id <span class="ot">&lt;-</span> <span class="fu">cumsum</span>(is_miss <span class="sc">!=</span> dplyr<span class="sc">::</span><span class="fu">lag</span>(is_miss, <span class="at">default =</span> <span class="cn">FALSE</span>))</span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a>  blocks <span class="ot">&lt;-</span> <span class="fu">split</span>(x, block_id)</span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a>  blocks <span class="ot">&lt;-</span> <span class="fu">lapply</span>(blocks, \(b) b[<span class="sc">!</span><span class="fu">is.na</span>(b)])</span>
<span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a>  blocks <span class="ot">&lt;-</span> <span class="fu">Filter</span>(\(b) <span class="fu">length</span>(b) <span class="sc">&gt;</span> <span class="dv">2</span>, blocks)</span>
<span id="cb3-44"><a href="#cb3-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">markovchainFit</span>(<span class="at">data =</span> blocks, <span class="at">method =</span> <span class="st">"mle"</span>)</span>
<span id="cb3-45"><a href="#cb3-45" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-46"><a href="#cb3-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-47"><a href="#cb3-47" aria-hidden="true" tabindex="-1"></a>markov_report <span class="ot">&lt;-</span> <span class="cf">function</span>(cat_col, <span class="at">group_cols =</span> <span class="fu">c</span>(<span class="st">"location"</span>)) {</span>
<span id="cb3-48"><a href="#cb3-48" aria-hidden="true" tabindex="-1"></a>  fit_tbl <span class="ot">&lt;-</span> weather_all <span class="sc">%&gt;%</span></span>
<span id="cb3-49"><a href="#cb3-49" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(<span class="fu">across</span>(<span class="fu">all_of</span>(group_cols))) <span class="sc">%&gt;%</span></span>
<span id="cb3-50"><a href="#cb3-50" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">seq =</span> <span class="fu">list</span>(.data[[cat_col]]), <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb3-51"><a href="#cb3-51" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb3-52"><a href="#cb3-52" aria-hidden="true" tabindex="-1"></a>      <span class="at">fit   =</span> <span class="fu">map</span>(seq, fit_markov_on_nonmissing_blocks),</span>
<span id="cb3-53"><a href="#cb3-53" aria-hidden="true" tabindex="-1"></a>      <span class="at">chain =</span> <span class="fu">map</span>(fit, <span class="st">"estimate"</span>)</span>
<span id="cb3-54"><a href="#cb3-54" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb3-55"><a href="#cb3-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-56"><a href="#cb3-56" aria-hidden="true" tabindex="-1"></a>  trans_out <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="st">"list"</span>, <span class="fu">nrow</span>(fit_tbl))</span>
<span id="cb3-57"><a href="#cb3-57" aria-hidden="true" tabindex="-1"></a>  tbl_out   <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="st">"list"</span>, <span class="fu">nrow</span>(fit_tbl))</span>
<span id="cb3-58"><a href="#cb3-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-59"><a href="#cb3-59" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_len</span>(<span class="fu">nrow</span>(fit_tbl))) {</span>
<span id="cb3-60"><a href="#cb3-60" aria-hidden="true" tabindex="-1"></a>    row <span class="ot">&lt;-</span> fit_tbl[i, ]</span>
<span id="cb3-61"><a href="#cb3-61" aria-hidden="true" tabindex="-1"></a>    chain <span class="ot">&lt;-</span> row<span class="sc">$</span>chain[[<span class="dv">1</span>]]</span>
<span id="cb3-62"><a href="#cb3-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-63"><a href="#cb3-63" aria-hidden="true" tabindex="-1"></a>    grp_vals <span class="ot">&lt;-</span> row <span class="sc">%&gt;%</span></span>
<span id="cb3-64"><a href="#cb3-64" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="fu">all_of</span>(group_cols)) <span class="sc">%&gt;%</span></span>
<span id="cb3-65"><a href="#cb3-65" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">everything</span>(), as.character))</span>
<span id="cb3-66"><a href="#cb3-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-67"><a href="#cb3-67" aria-hidden="true" tabindex="-1"></a>    seq_vec <span class="ot">&lt;-</span> row<span class="sc">$</span>seq[[<span class="dv">1</span>]] <span class="sc">%&gt;%</span></span>
<span id="cb3-68"><a href="#cb3-68" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as.factor</span>() <span class="sc">%&gt;%</span></span>
<span id="cb3-69"><a href="#cb3-69" aria-hidden="true" tabindex="-1"></a>      <span class="fu">fct_na_value_to_level</span>(<span class="at">level =</span> <span class="st">"unobserved"</span>)</span>
<span id="cb3-70"><a href="#cb3-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-71"><a href="#cb3-71" aria-hidden="true" tabindex="-1"></a>    <span class="co"># adequacy: transition count matrix + row sums</span></span>
<span id="cb3-72"><a href="#cb3-72" aria-hidden="true" tabindex="-1"></a>    transition_counts <span class="ot">&lt;-</span> <span class="fu">createSequenceMatrix</span>(seq_vec)</span>
<span id="cb3-73"><a href="#cb3-73" aria-hidden="true" tabindex="-1"></a>    row_totals <span class="ot">&lt;-</span> <span class="fu">rowSums</span>(transition_counts)</span>
<span id="cb3-74"><a href="#cb3-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-75"><a href="#cb3-75" aria-hidden="true" tabindex="-1"></a>    adequacy_tbl <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb3-76"><a href="#cb3-76" aria-hidden="true" tabindex="-1"></a>      <span class="at">state =</span> <span class="fu">names</span>(row_totals),</span>
<span id="cb3-77"><a href="#cb3-77" aria-hidden="true" tabindex="-1"></a>      <span class="at">outgoing_transitions =</span> <span class="fu">as.integer</span>(row_totals)</span>
<span id="cb3-78"><a href="#cb3-78" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb3-79"><a href="#cb3-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-80"><a href="#cb3-80" aria-hidden="true" tabindex="-1"></a>    <span class="co"># stationary + return times</span></span>
<span id="cb3-81"><a href="#cb3-81" aria-hidden="true" tabindex="-1"></a>    pi <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">steadyStates</span>(chain)[<span class="dv">1</span>, ])</span>
<span id="cb3-82"><a href="#cb3-82" aria-hidden="true" tabindex="-1"></a>    <span class="fu">names</span>(pi) <span class="ot">&lt;-</span> <span class="fu">states</span>(chain)</span>
<span id="cb3-83"><a href="#cb3-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-84"><a href="#cb3-84" aria-hidden="true" tabindex="-1"></a>    steady_tbl <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb3-85"><a href="#cb3-85" aria-hidden="true" tabindex="-1"></a>      <span class="at">state =</span> <span class="fu">names</span>(pi),</span>
<span id="cb3-86"><a href="#cb3-86" aria-hidden="true" tabindex="-1"></a>      <span class="at">stationary =</span> pi,</span>
<span id="cb3-87"><a href="#cb3-87" aria-hidden="true" tabindex="-1"></a>      <span class="at">expected_return_time =</span> <span class="dv">1</span> <span class="sc">/</span> pi</span>
<span id="cb3-88"><a href="#cb3-88" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb3-89"><a href="#cb3-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-90"><a href="#cb3-90" aria-hidden="true" tabindex="-1"></a>    tbl_out[[i]] <span class="ot">&lt;-</span> <span class="fu">bind_cols</span>(</span>
<span id="cb3-91"><a href="#cb3-91" aria-hidden="true" tabindex="-1"></a>      grp_vals[<span class="fu">rep</span>(<span class="dv">1</span>, <span class="fu">nrow</span>(steady_tbl)), ],</span>
<span id="cb3-92"><a href="#cb3-92" aria-hidden="true" tabindex="-1"></a>      <span class="fu">left_join</span>(steady_tbl, adequacy_tbl, <span class="at">by =</span> <span class="st">"state"</span>)</span>
<span id="cb3-93"><a href="#cb3-93" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb3-94"><a href="#cb3-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-95"><a href="#cb3-95" aria-hidden="true" tabindex="-1"></a>    <span class="co"># transition matrix</span></span>
<span id="cb3-96"><a href="#cb3-96" aria-hidden="true" tabindex="-1"></a>    trans_long <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(chain<span class="sc">@</span>transitionMatrix) <span class="sc">%&gt;%</span></span>
<span id="cb3-97"><a href="#cb3-97" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rownames_to_column</span>(<span class="st">"from"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb3-98"><a href="#cb3-98" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pivot_longer</span>(<span class="sc">-</span>from, <span class="at">names_to =</span> <span class="st">"to"</span>, <span class="at">values_to =</span> <span class="st">"p"</span>)</span>
<span id="cb3-99"><a href="#cb3-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-100"><a href="#cb3-100" aria-hidden="true" tabindex="-1"></a>    trans_out[[i]] <span class="ot">&lt;-</span> <span class="fu">bind_cols</span>(grp_vals, trans_long)</span>
<span id="cb3-101"><a href="#cb3-101" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb3-102"><a href="#cb3-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-103"><a href="#cb3-103" aria-hidden="true" tabindex="-1"></a>  summary_tbl <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(tbl_out) <span class="sc">%&gt;%</span></span>
<span id="cb3-104"><a href="#cb3-104" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(<span class="fu">across</span>(<span class="fu">all_of</span>(group_cols)), state)</span>
<span id="cb3-105"><a href="#cb3-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-106"><a href="#cb3-106" aria-hidden="true" tabindex="-1"></a>  tbl_kable <span class="ot">&lt;-</span> summary_tbl <span class="sc">%&gt;%</span></span>
<span id="cb3-107"><a href="#cb3-107" aria-hidden="true" tabindex="-1"></a>    <span class="fu">kable</span>(</span>
<span id="cb3-108"><a href="#cb3-108" aria-hidden="true" tabindex="-1"></a>      <span class="at">digits =</span> <span class="dv">4</span>,</span>
<span id="cb3-109"><a href="#cb3-109" aria-hidden="true" tabindex="-1"></a>      <span class="at">caption =</span> <span class="fu">paste0</span>(cat_col, <span class="st">": adequacy (outgoing transitions), stationary π, and expected return times"</span>)</span>
<span id="cb3-110"><a href="#cb3-110" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb3-111"><a href="#cb3-111" aria-hidden="true" tabindex="-1"></a>    <span class="fu">kable_styling</span>(<span class="at">full_width =</span> <span class="cn">FALSE</span>)</span>
<span id="cb3-112"><a href="#cb3-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-113"><a href="#cb3-113" aria-hidden="true" tabindex="-1"></a>  trans_df <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(trans_out)</span>
<span id="cb3-114"><a href="#cb3-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-115"><a href="#cb3-115" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> trans_df <span class="sc">%&gt;%</span></span>
<span id="cb3-116"><a href="#cb3-116" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> to, <span class="at">y =</span> from, <span class="at">fill =</span> p)) <span class="sc">+</span></span>
<span id="cb3-117"><a href="#cb3-117" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_tile</span>(<span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb3-118"><a href="#cb3-118" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">sprintf</span>(<span class="st">"%.2f"</span>, p)), <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb3-119"><a href="#cb3-119" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb3-120"><a href="#cb3-120" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="fu">paste0</span>(cat_col, <span class="st">" transition matrices by "</span>, <span class="fu">paste</span>(group_cols, <span class="at">collapse =</span> <span class="st">" × "</span>)),</span>
<span id="cb3-121"><a href="#cb3-121" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="st">"To"</span>, <span class="at">y =</span> <span class="st">"From"</span>, <span class="at">fill =</span> <span class="st">"P"</span></span>
<span id="cb3-122"><a href="#cb3-122" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb3-123"><a href="#cb3-123" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">12</span>)</span>
<span id="cb3-124"><a href="#cb3-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-125"><a href="#cb3-125" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(group_cols) <span class="sc">==</span> <span class="dv">1</span>) {</span>
<span id="cb3-126"><a href="#cb3-126" aria-hidden="true" tabindex="-1"></a>    p <span class="ot">&lt;-</span> p <span class="sc">+</span> <span class="fu">facet_wrap</span>(<span class="fu">as.formula</span>(<span class="fu">paste0</span>(<span class="st">"~"</span>, group_cols[<span class="dv">1</span>])))</span>
<span id="cb3-127"><a href="#cb3-127" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (<span class="fu">length</span>(group_cols) <span class="sc">==</span> <span class="dv">2</span>) {</span>
<span id="cb3-128"><a href="#cb3-128" aria-hidden="true" tabindex="-1"></a>    p <span class="ot">&lt;-</span> p <span class="sc">+</span> <span class="fu">facet_grid</span>(<span class="fu">as.formula</span>(<span class="fu">paste0</span>(group_cols[<span class="dv">2</span>], <span class="st">" ~ "</span>, group_cols[<span class="dv">1</span>])))</span>
<span id="cb3-129"><a href="#cb3-129" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb3-130"><a href="#cb3-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-131"><a href="#cb3-131" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">table =</span> tbl_kable, <span class="at">plot =</span> p))</span>
<span id="cb3-132"><a href="#cb3-132" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
</section>
</section>
<section id="part-1-location" class="level1">
<h1>Part 1: Location</h1>
<section id="summary-table-of-days-in-each-state" class="level2">
<h2 class="anchored" data-anchor-id="summary-table-of-days-in-each-state">Summary Table of Days in Each State</h2>
<section id="rainy-days" class="level3">
<h3 class="anchored" data-anchor-id="rainy-days">Rainy Days</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>rain_props_loc <span class="ot">&lt;-</span> <span class="fu">get_table</span>(rain, location)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>rain_props_loc <span class="sc">%&gt;%</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">props_kable</span>(<span class="fu">c</span>(<span class="st">"location"</span>), <span class="st">"Rain"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<table class="table caption-top table-sm table-striped small">
<caption>Rain State Proportions by location</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">location</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">none</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">light</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">heavy</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">NA</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left; font-weight: bold;">Marin County</td>
<td style="text-align: left;">67.55%</td>
<td style="text-align: left;">8.67%</td>
<td style="text-align: left;">3.98%</td>
<td style="text-align: left;">19.80%</td>
</tr>
<tr class="even">
<td style="text-align: left; font-weight: bold;">SLO County</td>
<td style="text-align: left;">88.41%</td>
<td style="text-align: left;">8.50%</td>
<td style="text-align: left;">2.92%</td>
<td style="text-align: left;">0.17%</td>
</tr>
<tr class="odd">
<td style="text-align: left; font-weight: bold;">San Diego</td>
<td style="text-align: left;">69.42%</td>
<td style="text-align: left;">4.07%</td>
<td style="text-align: left;">0.41%</td>
<td style="text-align: left;">26.10%</td>
</tr>
</tbody>
</table>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>rain_props_loc <span class="sc">%&gt;%</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> location, <span class="at">y =</span> prop, <span class="at">fill =</span> state)) <span class="sc">+</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>() <span class="sc">+</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span>percent) <span class="sc">+</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Rain state composition by location"</span>, <span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="st">"Proportion of days"</span>, <span class="at">fill =</span> <span class="st">"State"</span>) <span class="sc">+</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">12</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="MP1_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>We defined no rain as 0 inches of rain, light rain as between 0 and 1 inch of rain, and heavy rain as more than 1 inch of rain.</li>
<li>San Diego seems to be driest overall when we normalize for nonmissing values. About 94% of all observed days were dry, compared to 89% for SLO and 84% for Marin.</li>
<li>Marin experiences more light and heavy rain. It rained on about 16% of all observed days in Marin, 11% of all observed days in SLO and 6% of all observed days in San Diego when normalized for nonmissing values.</li>
</ul>
</section>
<section id="temperature" class="level3">
<h3 class="anchored" data-anchor-id="temperature">Temperature</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>temp_props_loc <span class="ot">&lt;-</span> <span class="fu">get_table</span>(temp, location)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>temp_props_loc <span class="sc">%&gt;%</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">props_kable</span>(<span class="fu">c</span>(<span class="st">"location"</span>), <span class="st">"Temp"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<table class="table caption-top table-sm table-striped small">
<caption>Temp State Proportions by location</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">location</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">cold</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">comfortable</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">hot</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">NA</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left; font-weight: bold;">Marin County</td>
<td style="text-align: left;">16.76%</td>
<td style="text-align: left;">25.48%</td>
<td style="text-align: left;">27.59%</td>
<td style="text-align: left;">30.17%</td>
</tr>
<tr class="even">
<td style="text-align: left; font-weight: bold;">SLO County</td>
<td style="text-align: left;">12.45%</td>
<td style="text-align: left;">45.64%</td>
<td style="text-align: left;">41.76%</td>
<td style="text-align: left;">0.14%</td>
</tr>
<tr class="odd">
<td style="text-align: left; font-weight: bold;">San Diego</td>
<td style="text-align: left;">3.62%</td>
<td style="text-align: left;">38.82%</td>
<td style="text-align: left;">14.03%</td>
<td style="text-align: left;">43.53%</td>
</tr>
</tbody>
</table>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>temp_props_loc <span class="sc">%&gt;%</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> location, <span class="at">y =</span> prop, <span class="at">fill =</span> state)) <span class="sc">+</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>() <span class="sc">+</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span>percent) <span class="sc">+</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Rain state composition by location"</span>, <span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="st">"Proportion of days"</span>, <span class="at">fill =</span> <span class="st">"State"</span>) <span class="sc">+</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">12</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="MP1_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<ul>
<li><p>We defined cold days as having maximum daily temperature less than 63 degrees, comfortable days being between 63 to 75 degrees at maximum, and hot days having greater than 75 degrees maximum.</p></li>
<li><p>Marin has highest proportion of cold days at almost 24% when normalized, compared to 12% for SLO and 6% for San Diego. This makes sense with how far north and coastal it is.</p></li>
<li><p>San Diego has the highest proportion of comfortable days. When normalized it is almost 69%, compared to 46% for SLO and about 36% for Marin.</p></li>
</ul>
</section>
</section>
<section id="fit-markov-models" class="level2">
<h2 class="anchored" data-anchor-id="fit-markov-models">Fit Markov Models</h2>
<section id="rain-behavior" class="level3">
<h3 class="anchored" data-anchor-id="rain-behavior">Rain Behavior</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>out <span class="ot">&lt;-</span> <span class="fu">markov_report</span>(<span class="st">"rain"</span>, <span class="fu">c</span>(<span class="st">"location"</span>))</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>out<span class="sc">$</span>table</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<table class="table caption-top table-sm table-striped small">
<caption>rain: adequacy (outgoing transitions), stationary π, and expected return times</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">location</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">state</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">stationary</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">expected_return_time</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">outgoing_transitions</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Marin County</td>
<td style="text-align: left;">heavy</td>
<td style="text-align: right;">0.0501</td>
<td style="text-align: right;">19.9404</td>
<td style="text-align: right;">165</td>
</tr>
<tr class="even">
<td style="text-align: left;">Marin County</td>
<td style="text-align: left;">light</td>
<td style="text-align: right;">0.1084</td>
<td style="text-align: right;">9.2289</td>
<td style="text-align: right;">362</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Marin County</td>
<td style="text-align: left;">none</td>
<td style="text-align: right;">0.8415</td>
<td style="text-align: right;">1.1884</td>
<td style="text-align: right;">2821</td>
</tr>
<tr class="even">
<td style="text-align: left;">SLO County</td>
<td style="text-align: left;">heavy</td>
<td style="text-align: right;">0.0294</td>
<td style="text-align: right;">34.0371</td>
<td style="text-align: right;">122</td>
</tr>
<tr class="odd">
<td style="text-align: left;">SLO County</td>
<td style="text-align: left;">light</td>
<td style="text-align: right;">0.0852</td>
<td style="text-align: right;">11.7410</td>
<td style="text-align: right;">355</td>
</tr>
<tr class="even">
<td style="text-align: left;">SLO County</td>
<td style="text-align: left;">none</td>
<td style="text-align: right;">0.8854</td>
<td style="text-align: right;">1.1294</td>
<td style="text-align: right;">3691</td>
</tr>
<tr class="odd">
<td style="text-align: left;">San Diego</td>
<td style="text-align: left;">heavy</td>
<td style="text-align: right;">0.0056</td>
<td style="text-align: right;">178.4111</td>
<td style="text-align: right;">17</td>
</tr>
<tr class="even">
<td style="text-align: left;">San Diego</td>
<td style="text-align: left;">light</td>
<td style="text-align: right;">0.0557</td>
<td style="text-align: right;">17.9587</td>
<td style="text-align: right;">170</td>
</tr>
<tr class="odd">
<td style="text-align: left;">San Diego</td>
<td style="text-align: left;">none</td>
<td style="text-align: right;">0.9387</td>
<td style="text-align: right;">1.0653</td>
<td style="text-align: right;">2899</td>
</tr>
</tbody>
</table>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>out<span class="sc">$</span>plot</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="MP1_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<ul>
<li><p>San Diego has an extremely expected long return time for heavy rain, at 178 days cumulatively.</p></li>
<li><p>Marin has the most frequent transitions to rainy states.</p></li>
<li><p>The “no rain” state is highly persistent for all locations. Additionally, across all three locations, we can observe that it is most likely to rain lightly after it has just rained heavily. In all three locations, it is most likely to stop raining after it has just rained lightly.</p></li>
</ul>
</section>
<section id="temperature-behavior" class="level3">
<h3 class="anchored" data-anchor-id="temperature-behavior">Temperature Behavior</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>out <span class="ot">&lt;-</span> <span class="fu">markov_report</span>(<span class="st">"temp"</span>, <span class="fu">c</span>(<span class="st">"location"</span>))</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>out<span class="sc">$</span>table</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<table class="table caption-top table-sm table-striped small">
<caption>temp: adequacy (outgoing transitions), stationary π, and expected return times</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">location</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">state</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">stationary</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">expected_return_time</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">outgoing_transitions</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Marin County</td>
<td style="text-align: left;">cold</td>
<td style="text-align: right;">0.2424</td>
<td style="text-align: right;">4.1246</td>
<td style="text-align: right;">699</td>
</tr>
<tr class="even">
<td style="text-align: left;">Marin County</td>
<td style="text-align: left;">comfortable</td>
<td style="text-align: right;">0.3649</td>
<td style="text-align: right;">2.7407</td>
<td style="text-align: right;">1064</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Marin County</td>
<td style="text-align: left;">hot</td>
<td style="text-align: right;">0.3927</td>
<td style="text-align: right;">2.5466</td>
<td style="text-align: right;">1152</td>
</tr>
<tr class="even">
<td style="text-align: left;">SLO County</td>
<td style="text-align: left;">cold</td>
<td style="text-align: right;">0.1251</td>
<td style="text-align: right;">7.9905</td>
<td style="text-align: right;">519</td>
</tr>
<tr class="odd">
<td style="text-align: left;">SLO County</td>
<td style="text-align: left;">comfortable</td>
<td style="text-align: right;">0.4569</td>
<td style="text-align: right;">2.1889</td>
<td style="text-align: right;">1906</td>
</tr>
<tr class="even">
<td style="text-align: left;">SLO County</td>
<td style="text-align: left;">hot</td>
<td style="text-align: right;">0.4180</td>
<td style="text-align: right;">2.3924</td>
<td style="text-align: right;">1744</td>
</tr>
<tr class="odd">
<td style="text-align: left;">San Diego</td>
<td style="text-align: left;">cold</td>
<td style="text-align: right;">0.0608</td>
<td style="text-align: right;">16.4490</td>
<td style="text-align: right;">151</td>
</tr>
<tr class="even">
<td style="text-align: left;">San Diego</td>
<td style="text-align: left;">comfortable</td>
<td style="text-align: right;">0.6926</td>
<td style="text-align: right;">1.4438</td>
<td style="text-align: right;">1620</td>
</tr>
<tr class="odd">
<td style="text-align: left;">San Diego</td>
<td style="text-align: left;">hot</td>
<td style="text-align: right;">0.2466</td>
<td style="text-align: right;">4.0555</td>
<td style="text-align: right;">586</td>
</tr>
</tbody>
</table>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>out<span class="sc">$</span>plot</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="MP1_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<ul>
<li><p>Temperature states are all highly persistent (as seen on diagonal).</p></li>
<li><p>San Diego has over double the return time to a cold state as the next longest return time to cold, which is SLO.</p></li>
<li><p>Marin is most likely to have streaks of hot days compared to the other two locations. San Diego is most likely to have streaks of comfortable days.</p></li>
</ul>
</section>
</section>
</section>
<section id="part-2-location-x-season" class="level1">
<h1>Part 2: Location x Season</h1>
<section id="summary-table-of-days-in-each-state-1" class="level2">
<h2 class="anchored" data-anchor-id="summary-table-of-days-in-each-state-1">Summary Table of Days in Each State</h2>
<section id="rain" class="level3">
<h3 class="anchored" data-anchor-id="rain">Rain</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>rain_props_loc_season <span class="ot">&lt;-</span> <span class="fu">get_table</span>(rain, location, season)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>rain_props_loc_season <span class="sc">%&gt;%</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">props_kable</span>(<span class="fu">c</span>(<span class="st">"location"</span>, <span class="st">"season"</span>), <span class="st">"Rain"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<table class="table caption-top table-sm table-striped small">
<caption>Rain State Proportions by location and season</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">location</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">season</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">none</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">light</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">heavy</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">NA</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left; font-weight: bold;">Marin County</td>
<td style="text-align: left;">Oct–Mar</td>
<td style="text-align: left;">58.09%</td>
<td style="text-align: left;">14.46%</td>
<td style="text-align: left;">7.42%</td>
<td style="text-align: left;">20.03%</td>
</tr>
<tr class="even">
<td style="text-align: left; font-weight: bold;">Marin County</td>
<td style="text-align: left;">Apr–Sep</td>
<td style="text-align: left;">77.15%</td>
<td style="text-align: left;">2.80%</td>
<td style="text-align: left;">0.48%</td>
<td style="text-align: left;">19.58%</td>
</tr>
<tr class="odd">
<td style="text-align: left; font-weight: bold;">SLO County</td>
<td style="text-align: left;">Oct–Mar</td>
<td style="text-align: left;">80.26%</td>
<td style="text-align: left;">13.99%</td>
<td style="text-align: left;">5.42%</td>
<td style="text-align: left;">0.33%</td>
</tr>
<tr class="even">
<td style="text-align: left; font-weight: bold;">SLO County</td>
<td style="text-align: left;">Apr–Sep</td>
<td style="text-align: left;">96.67%</td>
<td style="text-align: left;">2.94%</td>
<td style="text-align: left;">0.39%</td>
<td style="text-align: left;">0.00%</td>
</tr>
<tr class="odd">
<td style="text-align: left; font-weight: bold;">San Diego</td>
<td style="text-align: left;">Oct–Mar</td>
<td style="text-align: left;">61.13%</td>
<td style="text-align: left;">6.09%</td>
<td style="text-align: left;">0.71%</td>
<td style="text-align: left;">32.06%</td>
</tr>
<tr class="even">
<td style="text-align: left; font-weight: bold;">San Diego</td>
<td style="text-align: left;">Apr–Sep</td>
<td style="text-align: left;">77.82%</td>
<td style="text-align: left;">2.03%</td>
<td style="text-align: left;">0.10%</td>
<td style="text-align: left;">20.06%</td>
</tr>
</tbody>
</table>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>rain_props_loc_season <span class="sc">%&gt;%</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> season, <span class="at">y =</span> prop, <span class="at">fill =</span> state)) <span class="sc">+</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>() <span class="sc">+</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> location, <span class="at">ncol =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span>percent) <span class="sc">+</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Rain state composition by location and season"</span>, <span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="st">"Proportion of days"</span>, <span class="at">fill =</span> <span class="st">"State"</span>) <span class="sc">+</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">12</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="MP1_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<ul>
<li><p>Patterns dominated by seasonality for all locations.</p></li>
<li><p>Much rainier in Oct-March compared to Apr-Sept.</p></li>
<li><p>San Diego manages to stay dry year round, but very high proportion of missing data in Oct-March.</p></li>
</ul>
</section>
<section id="temperature-1" class="level3">
<h3 class="anchored" data-anchor-id="temperature-1">Temperature</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>temp_props_loc_season <span class="ot">&lt;-</span> <span class="fu">get_table</span>(temp, location, season)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>temp_props_loc_season <span class="sc">%&gt;%</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">props_kable</span>(<span class="fu">c</span>(<span class="st">"location"</span>, <span class="st">"season"</span>), <span class="st">"Temp"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<table class="table caption-top table-sm table-striped small">
<caption>Temp State Proportions by location and season</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">location</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">season</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">cold</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">comfortable</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">hot</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">NA</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left; font-weight: bold;">Marin County</td>
<td style="text-align: left;">Oct–Mar</td>
<td style="text-align: left;">31.35%</td>
<td style="text-align: left;">29.54%</td>
<td style="text-align: left;">10.56%</td>
<td style="text-align: left;">28.54%</td>
</tr>
<tr class="even">
<td style="text-align: left; font-weight: bold;">Marin County</td>
<td style="text-align: left;">Apr–Sep</td>
<td style="text-align: left;">1.98%</td>
<td style="text-align: left;">21.36%</td>
<td style="text-align: left;">44.84%</td>
<td style="text-align: left;">31.82%</td>
</tr>
<tr class="odd">
<td style="text-align: left; font-weight: bold;">SLO County</td>
<td style="text-align: left;">Oct–Mar</td>
<td style="text-align: left;">21.60%</td>
<td style="text-align: left;">51.14%</td>
<td style="text-align: left;">27.07%</td>
<td style="text-align: left;">0.19%</td>
</tr>
<tr class="even">
<td style="text-align: left; font-weight: bold;">SLO County</td>
<td style="text-align: left;">Apr–Sep</td>
<td style="text-align: left;">3.18%</td>
<td style="text-align: left;">40.07%</td>
<td style="text-align: left;">56.65%</td>
<td style="text-align: left;">0.10%</td>
</tr>
<tr class="odd">
<td style="text-align: left; font-weight: bold;">San Diego</td>
<td style="text-align: left;">Oct–Mar</td>
<td style="text-align: left;">6.61%</td>
<td style="text-align: left;">38.11%</td>
<td style="text-align: left;">10.04%</td>
<td style="text-align: left;">45.24%</td>
</tr>
<tr class="even">
<td style="text-align: left; font-weight: bold;">San Diego</td>
<td style="text-align: left;">Apr–Sep</td>
<td style="text-align: left;">0.58%</td>
<td style="text-align: left;">39.54%</td>
<td style="text-align: left;">18.08%</td>
<td style="text-align: left;">41.80%</td>
</tr>
</tbody>
</table>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>temp_props_loc_season <span class="sc">%&gt;%</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> season, <span class="at">y =</span> prop, <span class="at">fill =</span> state)) <span class="sc">+</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>() <span class="sc">+</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> location, <span class="at">ncol =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span>percent) <span class="sc">+</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Temperature state composition by location and season"</span>, <span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="st">"Proportion of days"</span>, <span class="at">fill =</span> <span class="st">"State"</span>) <span class="sc">+</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">12</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="MP1_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<ul>
<li><p>Once again, patterns strongly dominated by seasonality.</p></li>
<li><p>As expected, more hot days in summer and cold days in winter, with San Diego standing out as best weather once again.</p></li>
<li><p>Marin appears to be hot proportionally more than the other locations based on the observed data during the summer.</p></li>
</ul>
</section>
</section>
<section id="fit-markov-models-1" class="level2">
<h2 class="anchored" data-anchor-id="fit-markov-models-1">Fit Markov Models</h2>
<section id="rain-1" class="level3">
<h3 class="anchored" data-anchor-id="rain-1">Rain</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>out <span class="ot">&lt;-</span> <span class="fu">markov_report</span>(<span class="st">"rain"</span>, <span class="fu">c</span>(<span class="st">"location"</span>, <span class="st">"season"</span>))</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>out<span class="sc">$</span>table</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<table class="table caption-top table-sm table-striped small">
<caption>rain: adequacy (outgoing transitions), stationary π, and expected return times</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">location</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">season</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">state</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">stationary</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">expected_return_time</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">outgoing_transitions</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Marin County</td>
<td style="text-align: left;">Apr–Sep</td>
<td style="text-align: left;">heavy</td>
<td style="text-align: right;">0.0061</td>
<td style="text-align: right;">163.6797</td>
<td style="text-align: right;">10</td>
</tr>
<tr class="even">
<td style="text-align: left;">Marin County</td>
<td style="text-align: left;">Apr–Sep</td>
<td style="text-align: left;">light</td>
<td style="text-align: right;">0.0355</td>
<td style="text-align: right;">28.1635</td>
<td style="text-align: right;">57</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Marin County</td>
<td style="text-align: left;">Apr–Sep</td>
<td style="text-align: left;">none</td>
<td style="text-align: right;">0.9584</td>
<td style="text-align: right;">1.0434</td>
<td style="text-align: right;">1600</td>
</tr>
<tr class="even">
<td style="text-align: left;">Marin County</td>
<td style="text-align: left;">Oct–Mar</td>
<td style="text-align: left;">heavy</td>
<td style="text-align: right;">0.0936</td>
<td style="text-align: right;">10.6895</td>
<td style="text-align: right;">155</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Marin County</td>
<td style="text-align: left;">Oct–Mar</td>
<td style="text-align: left;">light</td>
<td style="text-align: right;">0.1804</td>
<td style="text-align: right;">5.5429</td>
<td style="text-align: right;">304</td>
</tr>
<tr class="even">
<td style="text-align: left;">Marin County</td>
<td style="text-align: left;">Oct–Mar</td>
<td style="text-align: left;">none</td>
<td style="text-align: right;">0.7260</td>
<td style="text-align: right;">1.3773</td>
<td style="text-align: right;">1221</td>
</tr>
<tr class="odd">
<td style="text-align: left;">SLO County</td>
<td style="text-align: left;">Apr–Sep</td>
<td style="text-align: left;">heavy</td>
<td style="text-align: right;">0.0039</td>
<td style="text-align: right;">259.1250</td>
<td style="text-align: right;">8</td>
</tr>
<tr class="even">
<td style="text-align: left;">SLO County</td>
<td style="text-align: left;">Apr–Sep</td>
<td style="text-align: left;">light</td>
<td style="text-align: right;">0.0294</td>
<td style="text-align: right;">33.9836</td>
<td style="text-align: right;">61</td>
</tr>
<tr class="odd">
<td style="text-align: left;">SLO County</td>
<td style="text-align: left;">Apr–Sep</td>
<td style="text-align: left;">none</td>
<td style="text-align: right;">0.9667</td>
<td style="text-align: right;">1.0344</td>
<td style="text-align: right;">2004</td>
</tr>
<tr class="even">
<td style="text-align: left;">SLO County</td>
<td style="text-align: left;">Oct–Mar</td>
<td style="text-align: left;">heavy</td>
<td style="text-align: right;">0.0547</td>
<td style="text-align: right;">18.2857</td>
<td style="text-align: right;">114</td>
</tr>
<tr class="odd">
<td style="text-align: left;">SLO County</td>
<td style="text-align: left;">Oct–Mar</td>
<td style="text-align: left;">light</td>
<td style="text-align: right;">0.1404</td>
<td style="text-align: right;">7.1204</td>
<td style="text-align: right;">294</td>
</tr>
<tr class="even">
<td style="text-align: left;">SLO County</td>
<td style="text-align: left;">Oct–Mar</td>
<td style="text-align: left;">none</td>
<td style="text-align: right;">0.8049</td>
<td style="text-align: right;">1.2424</td>
<td style="text-align: right;">1686</td>
</tr>
<tr class="odd">
<td style="text-align: left;">San Diego</td>
<td style="text-align: left;">Apr–Sep</td>
<td style="text-align: left;">heavy</td>
<td style="text-align: right;">0.0013</td>
<td style="text-align: right;">759.2170</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="even">
<td style="text-align: left;">San Diego</td>
<td style="text-align: left;">Apr–Sep</td>
<td style="text-align: left;">light</td>
<td style="text-align: right;">0.0253</td>
<td style="text-align: right;">39.5464</td>
<td style="text-align: right;">42</td>
</tr>
<tr class="odd">
<td style="text-align: left;">San Diego</td>
<td style="text-align: left;">Apr–Sep</td>
<td style="text-align: left;">none</td>
<td style="text-align: right;">0.9734</td>
<td style="text-align: right;">1.0273</td>
<td style="text-align: right;">1614</td>
</tr>
<tr class="even">
<td style="text-align: left;">San Diego</td>
<td style="text-align: left;">Oct–Mar</td>
<td style="text-align: left;">heavy</td>
<td style="text-align: right;">0.0105</td>
<td style="text-align: right;">95.2707</td>
<td style="text-align: right;">15</td>
</tr>
<tr class="odd">
<td style="text-align: left;">San Diego</td>
<td style="text-align: left;">Oct–Mar</td>
<td style="text-align: left;">light</td>
<td style="text-align: right;">0.0898</td>
<td style="text-align: right;">11.1362</td>
<td style="text-align: right;">128</td>
</tr>
<tr class="even">
<td style="text-align: left;">San Diego</td>
<td style="text-align: left;">Oct–Mar</td>
<td style="text-align: left;">none</td>
<td style="text-align: right;">0.8997</td>
<td style="text-align: right;">1.1115</td>
<td style="text-align: right;">1285</td>
</tr>
</tbody>
</table>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>out<span class="sc">$</span>plot</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="MP1_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<ul>
<li><p>The heavy rain returns times in Apr-Sept are impossibly long, especially for San Diego (759).</p></li>
<li><p>In winter, Marin County specifically has a large increase in estimated rainy states</p></li>
<li><p>Across all three locations, transition to no rain from a rainy state during the summer is more likely than the winter.</p></li>
</ul>
</section>
<section id="temperature-2" class="level3">
<h3 class="anchored" data-anchor-id="temperature-2">Temperature</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>out <span class="ot">&lt;-</span> <span class="fu">markov_report</span>(<span class="st">"temp"</span>, <span class="fu">c</span>(<span class="st">"location"</span>, <span class="st">"season"</span>))</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>out<span class="sc">$</span>table</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<table class="table caption-top table-sm table-striped small">
<caption>temp: adequacy (outgoing transitions), stationary π, and expected return times</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">location</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">season</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">state</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">stationary</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">expected_return_time</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">outgoing_transitions</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Marin County</td>
<td style="text-align: left;">Apr–Sep</td>
<td style="text-align: left;">cold</td>
<td style="text-align: right;">0.0287</td>
<td style="text-align: right;">34.9035</td>
<td style="text-align: right;">41</td>
</tr>
<tr class="even">
<td style="text-align: left;">Marin County</td>
<td style="text-align: left;">Apr–Sep</td>
<td style="text-align: left;">comfortable</td>
<td style="text-align: right;">0.3097</td>
<td style="text-align: right;">3.2285</td>
<td style="text-align: right;">442</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Marin County</td>
<td style="text-align: left;">Apr–Sep</td>
<td style="text-align: left;">hot</td>
<td style="text-align: right;">0.6616</td>
<td style="text-align: right;">1.5115</td>
<td style="text-align: right;">930</td>
</tr>
<tr class="even">
<td style="text-align: left;">Marin County</td>
<td style="text-align: left;">Oct–Mar</td>
<td style="text-align: left;">cold</td>
<td style="text-align: right;">0.4424</td>
<td style="text-align: right;">2.2603</td>
<td style="text-align: right;">658</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Marin County</td>
<td style="text-align: left;">Oct–Mar</td>
<td style="text-align: left;">comfortable</td>
<td style="text-align: right;">0.4143</td>
<td style="text-align: right;">2.4134</td>
<td style="text-align: right;">621</td>
</tr>
<tr class="even">
<td style="text-align: left;">Marin County</td>
<td style="text-align: left;">Oct–Mar</td>
<td style="text-align: left;">hot</td>
<td style="text-align: right;">0.1432</td>
<td style="text-align: right;">6.9816</td>
<td style="text-align: right;">222</td>
</tr>
<tr class="odd">
<td style="text-align: left;">SLO County</td>
<td style="text-align: left;">Apr–Sep</td>
<td style="text-align: left;">cold</td>
<td style="text-align: right;">0.0318</td>
<td style="text-align: right;">31.4192</td>
<td style="text-align: right;">66</td>
</tr>
<tr class="even">
<td style="text-align: left;">SLO County</td>
<td style="text-align: left;">Apr–Sep</td>
<td style="text-align: left;">comfortable</td>
<td style="text-align: right;">0.4006</td>
<td style="text-align: right;">2.4965</td>
<td style="text-align: right;">831</td>
</tr>
<tr class="odd">
<td style="text-align: left;">SLO County</td>
<td style="text-align: left;">Apr–Sep</td>
<td style="text-align: left;">hot</td>
<td style="text-align: right;">0.5676</td>
<td style="text-align: right;">1.7618</td>
<td style="text-align: right;">1174</td>
</tr>
<tr class="even">
<td style="text-align: left;">SLO County</td>
<td style="text-align: left;">Oct–Mar</td>
<td style="text-align: left;">cold</td>
<td style="text-align: right;">0.2176</td>
<td style="text-align: right;">4.5957</td>
<td style="text-align: right;">453</td>
</tr>
<tr class="odd">
<td style="text-align: left;">SLO County</td>
<td style="text-align: left;">Oct–Mar</td>
<td style="text-align: left;">comfortable</td>
<td style="text-align: right;">0.5124</td>
<td style="text-align: right;">1.9517</td>
<td style="text-align: right;">1075</td>
</tr>
<tr class="even">
<td style="text-align: left;">SLO County</td>
<td style="text-align: left;">Oct–Mar</td>
<td style="text-align: left;">hot</td>
<td style="text-align: right;">0.2700</td>
<td style="text-align: right;">3.7031</td>
<td style="text-align: right;">569</td>
</tr>
<tr class="odd">
<td style="text-align: left;">San Diego</td>
<td style="text-align: left;">Apr–Sep</td>
<td style="text-align: left;">cold</td>
<td style="text-align: right;">0.0085</td>
<td style="text-align: right;">118.0000</td>
<td style="text-align: right;">12</td>
</tr>
<tr class="even">
<td style="text-align: left;">San Diego</td>
<td style="text-align: left;">Apr–Sep</td>
<td style="text-align: left;">comfortable</td>
<td style="text-align: right;">0.6804</td>
<td style="text-align: right;">1.4698</td>
<td style="text-align: right;">819</td>
</tr>
<tr class="odd">
<td style="text-align: left;">San Diego</td>
<td style="text-align: left;">Apr–Sep</td>
<td style="text-align: left;">hot</td>
<td style="text-align: right;">0.3112</td>
<td style="text-align: right;">3.2139</td>
<td style="text-align: right;">375</td>
</tr>
<tr class="even">
<td style="text-align: left;">San Diego</td>
<td style="text-align: left;">Oct–Mar</td>
<td style="text-align: left;">cold</td>
<td style="text-align: right;">0.1181</td>
<td style="text-align: right;">8.4709</td>
<td style="text-align: right;">139</td>
</tr>
<tr class="odd">
<td style="text-align: left;">San Diego</td>
<td style="text-align: left;">Oct–Mar</td>
<td style="text-align: left;">comfortable</td>
<td style="text-align: right;">0.7018</td>
<td style="text-align: right;">1.4249</td>
<td style="text-align: right;">800</td>
</tr>
<tr class="even">
<td style="text-align: left;">San Diego</td>
<td style="text-align: left;">Oct–Mar</td>
<td style="text-align: left;">hot</td>
<td style="text-align: right;">0.1801</td>
<td style="text-align: right;">5.5511</td>
<td style="text-align: right;">211</td>
</tr>
</tbody>
</table>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>out<span class="sc">$</span>plot</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="MP1_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<ul>
<li><p>Temperature persistence occurs once again during the winter, but not as strongly during the summer.</p></li>
<li><p>During summer hot to hot persistence is extremely high. This means there are more likely to be streaks of hot days.</p></li>
<li><p>San Diego has the most persistence in the comfortable state across both seasons.</p></li>
<li><p>The expected return time for the cold state in San Diego summers is very long (118). The next longest expected return time for the cold state is in about 35 in Marin, meaning cold days are much more common in Marin and SLO summers than in San Diego.</p></li>
</ul>
</section>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>